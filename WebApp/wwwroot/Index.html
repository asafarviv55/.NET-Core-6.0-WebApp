<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <script src="https://cdn.jsdelivr.net/npm/vue@3"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/purecss@3.0.0/build/pure-min.css" integrity="sha384-X38yfunGUhNzHpBaEBsWLO+A0HDYOQi8ufWDkZ0k9e0eXz/tH3II7uKZ9msv++Ls" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.2/axios.min.js"></script>
    <!-- Add this to <head> -->
    <!-- Load required Bootstrap and BootstrapVue CSS -->
    <link type="text/css" rel="stylesheet" href="https://unpkg.com/bootstrap/dist/css/bootstrap.min.css" />
    <link type="text/css" rel="stylesheet" href="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.min.css" />

    <!-- Load polyfills to support older browsers -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es2015%2CIntersectionObserver" crossorigin="anonymous"></script>

    <!-- Load Vue followed by BootstrapVue -->
    <script src="https://unpkg.com/vue@latest/dist/vue.min.js"></script>
    <script src="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.min.js"></script>

    <!-- Load the following for BootstrapVueIcons support -->
    <script src="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue-icons.min.js"></script>

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto|Varela+Round|Open+Sans">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
</head>
<body>


    
    <div id="app" style="margin-top:70px">
        <div class="container">
          
                <div>
                    <label for="searchBox">Refresh All Products </label>
                    <input type="button" id="refresh" value="Refresh" v-on:click="refreshData()" /><br>
                    <label for="searchBox">Create All Products </label>
                    <input type="button" id="create" value="InitialProducts" v-on:click="create()" /><br>
                    <label for="searchBox">Please Type String to Search </label>
                    <input type="text" id="searchBox" value="" v-on:input="search" />
                </div>



                <table id="myTable" class=" table order-list">
                    <thead>
                        <tr>
                            <th style="width:80px" v-on:click="sort(1)">Product Code</th>

                            <th style="width:150px" v-on:click="sort(2)">Name</th>

                            <th style="width:300px" v-on:click="sort(3)">Description</th>

                            <th style="width:300px" v-on:click="sort(4)">Sell Date</th>

                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="(row,index) in allProducts">
                            <td hidden>{{row.id}}</td>
                            <td name="code">{{row.code}}</td>
                            <td name="name">{{row.name}}</td>
                            <td name="description">{{row.description}}</td>
                            <td name="sell_date">{{row.sell_date}}</td>
                            <td v-on:click="editRow(row.id)">Edit</td>
                            <td v-on:click="deleteItem(row.id)">Delete</td>
                            <td></td>
                        </tr>
                    </tbody>
                    <tfoot>
                        <tr>
                            <td colspan="5" style="text-align: left;">
                                <input type="button" class="btn btn-lg btn-block " id="addrow" value="Add Row" />
                            </td>
                        </tr>
                        <tr>
                            <td colspan="5" style="text-align: left;">
                                <input type="button" id="submitRow" value="submitRow" v-on:click="addRow();" />
                                <label for="searchBox">Refresh All Products </label>
                                <input type="button" id="refresh" value="Refresh" v-on:click="refreshData()" /><br>
                            </td>
                        </tr>
                    </tfoot>
                </table>
                
            </div>
            <div class="pure-u-1-5"></div>
        </div>
 
   
        <script>
            $(document).ready(function(){
                var counter = 0;

                $("#addrow").on("click", function () {
                    var newRow = $("<tr id='newRow'>");
                    var cols = "";
                     cols += '<td><input type="text" class="form-control" value="" id="newCode" name="code"' + counter + '"/></td>';
                    cols += '<td><input type="text" class="form-control" value="" id="newName" name="name"' + counter + '"/></td>';
                    cols += '<td><input type="text" class="form-control"  value="" id="newDescription" name="description"' + counter + '"/></td>';
                    cols += '<td></td>';

                    cols += '<td><input type="button" class="ibtnDel btn btn-md btn-danger "  value="Delete"></td>';
  
                    newRow.append(cols);
                    $("table.order-list").append(newRow);
                    counter++;
                });


                $("#editRow").on("click", function () {
                    var newRow = $("<tr id='newRowEdit'>");
                    var cols = "";
                    cols += '<td><input type="text" class="form-control" value="" id="newEditCode" name="code"' + counter + '"/></td>';
                    cols += '<td><input type="text" class="form-control" value="" id="newEditName" name="name"' + counter + '"/></td>';
                    cols += '<td><input type="text" class="form-control"  value="" id="newEditDescription" name="description"' + counter + '"/></td>';
                    cols += '<td></td>';

                    cols += '<td><input type="button" class="ibtnDel btn btn-md btn-danger "  value="Delete"></td>';

                    newRow.append(cols);
                    $("table.order-list").append(newRow);
                    counter++;
                });






                $("table.order-list").on("click", ".ibtnDel", function (event) {
                    $(this).closest("tr").remove();       
                    counter -= 1
                });

            });
    
    </script>

    <script>
        const App = {
            mounted() {
                axios.get("api/Products/GetAllProducts")
                    .then(response => {
                        this.allProducts = response.data;
                        this.rKey++;
                    })
            },
            data() {
                return {
                    items:[],
                    allProducts: [],
                    rKey: 0,
                    message: "Hello Element Plus",
                    page: 1,
                    sortColumn: 1,
                    sortDirection: 1,
                    filterString: '',
                    offset: 5,
                    searctStr: '',
                    newCode1: '' ,
                    newDescription1: '' ,
                    newName1: '' ,
                    newSell_date1: ''
                }
            },
            methods: {
                addRow(){
                    this.newCode1 = $('#newCode').val();
                    this.newName1 = $('#newDescription').val();
                    this.newDescription1 = $('#newName').val();
                    this.newSell_date1 = $('#newSell_date').val();

                    querystr = "api/Products/AddNewProduct?code="+this.newCode1+"&name="+this.newName1+"&description="
                                +this.newDescription1 ;
                    axios.get(querystr);
                },
                create() {
                    querystr = "api/Products/InitialProducts";
                    axios.get(querystr);
                    this.refreshData();
                },
                editRow(id) {
                    this.newCode1 = $('#newEditCode').val();
                    this.newName1 = $('#newEditDescription').val();
                    this.newDescription1 = $('#newEditName').val();
 
                    querystr = "api/Products/UpdateProduct?id=" + id + "&code=" + this.newCode1 + "&name=" + this.newName1 + "&description="
                        + this.newDescription1;
                    axios.get(querystr);

                 },
                deleteItem(id) {
                    querystr = "api/Products/DeleteProduct?id=" + id;
                    axios.delete(querystr);
                    this.refreshData();
                },
                sort(col) {
                    if (this.sortDirection == 1)
                        this.sortDirection = 0;
                    else
                        this.sortDirection = 1;
                    var querystr = "api/Products/GetAllProductsOrderBy?orderCol=" + col + "&orderDirection=" + this.sortDirection;

                    axios.get(querystr)
                        .then(response => {
                            this.allProducts = response.data;
                            this.rKey++;
                        })

                    this.refreshData();

                },
                search(event) {
                    this.searctStr = event.target.value;
                    if (this.searctStr == '' || this.searctStr == undefined)
                        this.refreshData();
                    else
                        axios.get("api/Products/SearchProducts?str=" + this.searctStr)
                            .then(response => {
                                this.allProducts = response.data;
                                this.rKey++;
                            })
                },
                refreshData() {
                    querystr = "api/Products/GetAllProducts";
                    axios.get(querystr)
                        .then(response => {
                            this.allProducts = response.data;
                            this.rKey++;
                        })
                }
            }
        };
        const app = Vue.createApp(App);
        app.mount("#app");


    </script>

</body>
</html>